<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brotato x Infinite Craft - LLM Roguelike</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Phaser 3 -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
</head>
<body>
    <!-- Game Canvas Container -->
    <div id="game-container"></div>

    <!-- Round HUD (top-center) -->
    <div id="round-hud" class="round-hud">
        <div class="round-info">
            <span id="round-number">Round: 1</span>
            <span class="separator">|</span>
            <span id="round-timer">Time: 30s</span>
            <span class="separator">|</span>
            <span id="enemy-count">Enemies: 0</span>
        </div>
    </div>

    <!-- UI Panel (HIDDEN - crafting now in shop modal) -->
    <div id="ui-panel" class="ui-panel" style="display: none;">
        <button id="toggle-ui-btn" class="toggle-ui-btn">📦</button>
        
        <div id="ui-content" class="ui-content">
            <!-- Header -->
            <header>
                <h1>🔮 Item Fusion</h1>
                <p class="subtitle">Combine items to create unique equipment</p>
            </header>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-label">Total Items</div>
                <div class="stat-value" id="stat-total">10</div>
            </div>
            <div class="stat">
                <div class="stat-label">Generated</div>
                <div class="stat-value" id="stat-generated">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Combinations</div>
                <div class="stat-value" id="stat-combinations">0</div>
            </div>
        </div>

        <!-- Fusion Interface -->
        <div class="fusion-interface">
            <h2>Select Items to Combine</h2>
            
            <div class="selection-area">
                <div class="item-selector">
                    <label for="item1-select">Item 1:</label>
                    <select id="item1-select">
                        <option value="">-- Select Item --</option>
                    </select>
                </div>

                <div class="item-selector">
                    <label for="item2-select">Item 2:</label>
                    <select id="item2-select">
                        <option value="">-- Select Item --</option>
                    </select>
                </div>
            </div>

            <div class="button-group">
                <button id="combine-btn">🔮 Combine Items</button>
                <button id="clear-data-btn">🗑️ Clear All Data</button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading">
            <div class="spinner"></div>
            <p>🤖 Generating item with LLM...</p>
        </div>

        <!-- Result Display -->
        <div id="result-container">
            <h2>Result</h2>
            <div id="result-content"></div>
            
            <button id="toggle-json-btn">Show JSON</button>
            <div id="json-container">
                <pre id="json-output"></pre>
            </div>
        </div>

        <!-- Inventory Display -->
        <div class="inventory-section">
            <h2>Your Inventory</h2>
            <p class="inventory-hint">💡 Click any item to view details</p>
            <div id="inventory-list"></div>
        </div>

        <!-- Item Detail View -->
        <div id="item-detail-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-modal" id="close-item-detail">&times;</span>
                <div id="item-detail-content"></div>
            </div>
        </div>
        </div> <!-- end ui-content -->
    </div> <!-- end ui-panel -->

    <!-- Shop + Crafting Modal (Between Rounds) -->
    <div id="shop-modal" class="modal" style="display: none;">
        <div class="modal-content shop-modal-content">
            <h1 class="shop-title" id="shop-round-number">Round 1 Complete!</h1>
            <div class="shop-currency-header">
                <span id="shop-currency-display">💰 0</span>
            </div>
            
            <div class="shop-layout">
                <!-- Left Column: Shop -->
                <div class="shop-column">
                    <h2>🛒 Shop</h2>
                    <div id="shop-items" class="shop-items-grid"></div>
                    <button id="reroll-shop-btn" class="reroll-btn">🔄 Reroll Shop (💰 10)</button>
                </div>

                <!-- Right Column: Crafting -->
                <div class="crafting-column">
                    <h2>🔮 Item Fusion</h2>
                    <p class="crafting-subtitle">Combine items to create new ones</p>
                    
                    <!-- Item selectors -->
                    <div class="crafting-selectors">
                        <div class="crafting-item-selector">
                            <label for="shop-item1-select">Item 1:</label>
                            <select id="shop-item1-select">
                                <option value="">-- Select Item --</option>
                            </select>
                        </div>

                        <div class="crafting-item-selector">
                            <label for="shop-item2-select">Item 2:</label>
                            <select id="shop-item2-select">
                                <option value="">-- Select Item --</option>
                            </select>
                        </div>
                    </div>

                    <button id="shop-combine-btn" class="shop-combine-btn">🔮 Combine (💰 50)</button>

                    <!-- Crafting result area -->
                    <div id="shop-crafting-result" class="shop-crafting-result" style="display: none;">
                        <div class="crafted-item-display" id="crafted-item-display"></div>
                        <div class="crafting-options">
                            <button id="craft-buy-equip-btn" class="craft-option-btn primary">Buy & Equip</button>
                            <button id="craft-add-pool-btn" class="craft-option-btn secondary">Add to Pool</button>
                            <button id="craft-discard-btn" class="craft-option-btn danger">Discard</button>
                        </div>
                    </div>

                    <!-- Loading state for crafting -->
                    <div id="shop-crafting-loading" style="display: none;">
                        <div class="spinner-small"></div>
                        <p>🤖 Crafting with LLM...</p>
                    </div>
                </div>
            </div>

            <!-- Bottom: Ready button -->
            <button id="start-next-round-from-shop-btn" class="start-round-btn">🚀 Ready for Next Round</button>

            <!-- Player Inventory Display (below ready button) -->
            <div class="shop-player-inventory">
                <h3>📦 Your Current Items</h3>
                <div id="shop-player-inventory-list" class="shop-inventory-grid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="modal" style="display: none;">
        <div class="modal-content game-over-content">
            <h1 class="game-over-title">💀 Game Over</h1>
            <p class="game-over-text">You have been defeated!</p>
            <button id="restart-btn" class="restart-btn">🔄 Restart Game</button>
        </div>
    </div>

    <!-- Pause Menu Modal -->
    <div id="pause-modal" class="modal" style="display: none;">
        <div class="modal-content pause-modal-content">
            <h1 class="pause-title">⏸️ PAUSED</h1>
            
            <!-- Round & Currency Info -->
            <div id="pause-round-info" class="pause-round-info"></div>
            
            <div class="pause-layout">
                <!-- Left Column: Player Stats -->
                <div id="pause-player-stats" class="pause-stats-column"></div>
                
                <!-- Right Column: Equipped Items -->
                <div id="pause-equipped-items" class="pause-items-column"></div>
            </div>
            
            <!-- Action Buttons -->
            <div class="pause-buttons">
                <button id="resume-btn" class="pause-btn primary">▶️ Resume</button>
                <button id="restart-from-pause-btn" class="pause-btn secondary">🔄 Restart Game</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Configuration -->
    <script src="config.js"></script>
    
    <!-- Item System -->
    <script src="items/startingItems.js"></script>
    <script src="items/itemStorage.js"></script>
    <script src="items/itemFusionPrompt.js"></script>
    <script src="items/itemGenerator.js"></script>
    
    <!-- UI Components -->
    <script src="ui/ItemDetailModal.js"></script>
    <script src="ui/ShopCraftingUI.js"></script>
    <script src="ui/HealthBar.js"></script>
    <script src="ui/GameOverScreen.js"></script>
    <script src="ui/ShopScreen.js"></script>
    <script src="ui/PauseMenu.js"></script>
    
    <!-- Game Entities -->
    <script src="game/Player.js"></script>
    <script src="game/Enemy.js"></script>
    <script src="game/Projectile.js"></script>
    <script src="game/Weapon.js"></script>
    <script src="game/Currency.js"></script>
    
    <!-- Game Managers -->
    <script src="game/CurrencyManager.js"></script>
    <script src="game/WaveManager.js"></script>
    
    <!-- Scenes -->
    <!-- GameScene Helpers -->
    <script src="scenes/GameScene/VisualEffects.js"></script>
    <script src="scenes/GameScene/CollisionHandler.js"></script>
    <script src="scenes/GameScene/DebugManager.js"></script>
    <!-- Main GameScene -->
    <script src="scenes/GameScene/GameScene.js"></script>
    
    <!-- Game Initialization -->
    <script src="game.js"></script>
    
    <!-- Initialize UI Components -->
    <script>
        // Initialize UI components after all scripts are loaded
        const itemDetailModal = new ItemDetailModal();
        const shopCraftingUI = new ShopCraftingUI();
        
        // Backwards compatibility: legacy 'ui' reference for ShopScreen
        const ui = shopCraftingUI;
    </script>
</body>
</html>

